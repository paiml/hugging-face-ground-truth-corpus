"""Training recipes for HuggingFace models.

This module provides utilities for model training using
the HuggingFace Trainer API, PEFT for parameter-efficient fine-tuning,
and distributed training strategies.

Examples:
    >>> from hf_gtc.training import TrainingConfig, TrainerState
    >>> config = TrainingConfig(output_dir="/tmp/test")
    >>> config.num_epochs
    3
    >>> state = TrainerState(global_step=100, epoch=1.5)
    >>> state.global_step
    100
"""

from __future__ import annotations

from hf_gtc.training.callbacks import (
    CallbackMetrics,
    CheckpointConfig,
    EarlyStoppingConfig,
    LoggingConfig,
    MetricMode,
    create_early_stopping_callback,
    create_logging_callback,
    get_recommended_callbacks,
    list_callback_types,
    should_stop_early,
    validate_checkpoint_config,
    validate_early_stopping_config,
    validate_logging_config,
)
from hf_gtc.training.continual import (
    VALID_CONTINUAL_METHODS,
    VALID_REGULARIZATION_TYPES,
    VALID_REPLAY_STRATEGIES,
    ContinualConfig,
    ContinualMethod,
    EWCConfig,
    ForgettingMetrics,
    RegularizationType,
    ReplayConfig,
    ReplayStrategy,
    calculate_backward_transfer,
    calculate_ewc_penalty,
    calculate_fisher_information,
    calculate_forgetting_measure,
    calculate_forward_transfer,
    calculate_plasticity_score,
    create_continual_config,
    create_ewc_config,
    create_forgetting_metrics,
    create_replay_config,
    estimate_importance_weights,
    format_forgetting_metrics,
    get_continual_method,
    get_recommended_continual_config,
    get_regularization_type,
    get_replay_strategy,
    list_continual_methods,
    list_regularization_types,
    list_replay_strategies,
    validate_continual_config,
    validate_ewc_config,
    validate_forgetting_metrics,
    validate_replay_config,
)
from hf_gtc.training.curriculum import (
    VALID_DIFFICULTY_METRICS,
    VALID_PACING_FUNCTIONS,
    VALID_SAMPLING_STRATEGIES,
    CurriculumConfig,
    CurriculumStats,
    DifficultyConfig,
    DifficultyMetric,
    PacingConfig,
    PacingFunction,
    SamplingStrategy,
    calculate_competence_score,
    calculate_sample_difficulty,
    calculate_sample_weights,
    create_curriculum_config,
    create_curriculum_stats,
    create_difficulty_config,
    create_pacing_config,
    format_curriculum_stats,
    get_difficulty_at_step,
    get_difficulty_metric,
    get_pacing_function,
    get_recommended_curriculum_config,
    get_sampling_strategy,
    list_difficulty_metrics,
    list_pacing_functions,
    list_sampling_strategies,
    validate_curriculum_config,
    validate_curriculum_stats,
    validate_difficulty_config,
    validate_pacing_config,
)
from hf_gtc.training.distillation import (
    VALID_DISTILLATION_LOSSES,
    VALID_DISTILLATION_METHODS,
    VALID_STUDENT_INITIALIZATIONS,
    VALID_TEMPERATURE_SCHEDULES,
    DistillationConfig,
    DistillationLoss,
    DistillationLossConfig,
    DistillationMethod,
    DistillationStats,
    FeatureMatchingConfig,
    StudentConfig,
    StudentInitialization,
    TeacherConfig,
    TemperatureSchedule,
    calculate_combined_loss,
    calculate_soft_labels_loss,
    calculate_temperature_at_step,
    create_distillation_config,
    create_distillation_stats,
    create_feature_matching_config,
    create_loss_config,
    create_student_config,
    create_teacher_config,
    estimate_compression_ratio,
    estimate_model_parameters,
    format_distillation_stats,
    get_distillation_loss,
    get_distillation_method,
    get_layer_mapping_strategy,
    get_recommended_distillation_config,
    get_student_initialization,
    get_temperature_schedule,
    list_distillation_losses,
    list_distillation_methods,
    list_student_initializations,
    list_temperature_schedules,
    validate_distillation_config,
    validate_feature_matching_config,
    validate_loss_config,
    validate_student_config,
    validate_teacher_config,
)
from hf_gtc.training.distributed import (
    VALID_BACKENDS,
    VALID_CHECKPOINTING,
    VALID_DEEPSPEED_STAGES,
    VALID_SHARDING_STRATEGIES,
    ActivationCheckpointing,
    DeepSpeedConfig,
    DeepSpeedStage,
    DistributedBackend,
    DistributedConfig,
    FSDPConfig,
    MemoryEstimate,
    ScalingMetrics,
    ShardingStrategy,
    calculate_scaling_efficiency,
    create_deepspeed_config,
    create_distributed_config,
    create_fsdp_config,
    estimate_deepspeed_memory,
    estimate_fsdp_memory,
    format_memory_estimate,
    get_deepspeed_stage,
    get_recommended_strategy,
    get_sharding_strategy,
    list_backends,
    list_deepspeed_stages,
    list_sharding_strategies,
    validate_deepspeed_config,
    validate_distributed_config,
    validate_fsdp_config,
)
from hf_gtc.training.dpo import (
    VALID_DPO_VARIANTS,
    VALID_LOSS_TYPES,
    VALID_REFERENCE_POLICIES,
    DPOConfig,
    DPOStats,
    DPOTrainingConfig,
    DPOVariant,
    LossType,
    PreferencePair,
    ReferenceConfig,
    ReferencePolicy,
    calculate_dpo_loss,
    create_dpo_config,
    create_dpo_training_config,
    create_preference_pair,
    create_reference_config,
    estimate_training_steps,
    get_dpo_variant,
    get_loss_type,
    get_reference_policy,
    list_dpo_variants,
    list_loss_types,
    list_reference_policies,
    validate_dpo_config,
    validate_preference_pair,
)
from hf_gtc.training.federated import (
    VALID_AGGREGATION_METHODS,
    VALID_CLIENT_SELECTION_STRATEGIES,
    VALID_PRIVACY_MECHANISMS,
    AggregationMethod,
    ClientConfig,
    ClientSelectionStrategy,
    FederatedConfig,
    FederatedStats,
    PrivacyConfig,
    PrivacyMechanism,
    aggregate_updates,
    calculate_client_weights,
    calculate_privacy_budget,
    create_client_config,
    create_federated_config,
    create_federated_stats,
    create_privacy_config,
    estimate_convergence_rounds,
    format_federated_stats,
    get_aggregation_method,
    get_client_selection_strategy,
    get_privacy_mechanism,
    get_recommended_federated_config,
    list_aggregation_methods,
    list_client_selection_strategies,
    list_privacy_mechanisms,
    select_clients,
    validate_client_config,
    validate_federated_config,
    validate_federated_stats,
    validate_privacy_config,
)
from hf_gtc.training.fine_tuning import (
    TrainingConfig,
    compute_num_training_steps,
    create_trainer,
    create_training_args,
    validate_training_config,
)
from hf_gtc.training.lora import (
    LoRAConfig,
    TaskType,
    calculate_lora_memory_savings,
    create_lora_config,
    estimate_lora_parameters,
    get_peft_config,
    get_recommended_lora_config,
    list_task_types,
)
from hf_gtc.training.moe import (
    VALID_EXPERT_ACTIVATIONS,
    VALID_LOAD_BALANCING_LOSSES,
    VALID_ROUTER_TYPES,
    ExpertActivation,
    ExpertConfig,
    LoadBalanceConfig,
    LoadBalancingLoss,
    MoEConfig,
    MoEStats,
    RouterConfig,
    RouterType,
    calculate_capacity_factor,
    calculate_load_balance_loss,
    calculate_router_entropy,
    create_expert_config,
    create_load_balance_config,
    create_moe_config,
    create_moe_stats,
    create_router_config,
    estimate_expert_utilization,
    format_moe_stats,
    get_expert_activation,
    get_load_balancing_loss,
    get_recommended_moe_config,
    get_router_type,
    list_expert_activations,
    list_load_balancing_losses,
    list_router_types,
    validate_expert_config,
    validate_load_balance_config,
    validate_moe_config,
    validate_router_config,
)
from hf_gtc.training.ppo import (
    VALID_PPO_VARIANTS,
    VALID_REWARD_MODEL_TYPES,
    VALID_VALUE_HEAD_TYPES,
    PPOConfig,
    PPOStats,
    PPOTrainingConfig,
    PPOVariant,
    RewardConfig,
    RewardModelType,
    ValueConfig,
    ValueHeadType,
    calculate_gae,
    calculate_ppo_loss,
    create_ppo_config,
    create_ppo_training_config,
    create_reward_config,
    create_value_config,
    get_ppo_variant,
    get_reward_model_type,
    get_value_head_type,
    list_ppo_variants,
    list_reward_model_types,
    list_value_head_types,
    validate_ppo_config,
    validate_ppo_training_config,
    validate_reward_config,
    validate_value_config,
)
from hf_gtc.training.qlora import (
    ComputeType,
    QLoRAConfig,
    QLoRATrainingConfig,
    QuantConfig,
    QuantType,
    calculate_qlora_trainable_params,
    create_qlora_config,
    create_qlora_training_config,
    create_quant_config,
    estimate_qlora_memory,
    get_bnb_config,
    get_compute_type,
    get_qlora_peft_config,
    get_quant_type,
    get_recommended_qlora_config,
    list_compute_types,
    list_quant_bits,
    list_quant_types,
    validate_compute_type,
    validate_qlora_config,
    validate_quant_config,
    validate_quant_type,
)

# Note: MemoryEstimate is from distributed module, format_memory_estimate as well
# (qlora has its own format_memory_estimate which we use a different name for)
from hf_gtc.training.qlora import format_memory_estimate as format_qlora_memory_estimate
from hf_gtc.training.trainer import (
    SchedulerConfig,
    SchedulerType,
    TrainerState,
    TrainingProgress,
    compute_warmup_steps,
    create_trainer_state,
    create_training_progress,
    format_training_progress,
    get_checkpoint_path,
    get_checkpoints_to_delete,
    get_early_stopping_mode,
    get_latest_checkpoint,
    get_scheduler_type,
    is_metric_improved,
    list_checkpoints,
    list_early_stopping_modes,
    list_scheduler_types,
    update_trainer_state,
    validate_scheduler_config,
    validate_scheduler_type,
    validate_trainer_state,
)

__all__: list[str] = [
    "VALID_AGGREGATION_METHODS",
    "VALID_AGGREGATION_METHODS",
    "VALID_BACKENDS",
    "VALID_CHECKPOINTING",
    "VALID_CLIENT_SELECTION_STRATEGIES",
    "VALID_CLIENT_SELECTION_STRATEGIES",
    "VALID_CONTINUAL_METHODS",
    "VALID_DEEPSPEED_STAGES",
    "VALID_DIFFICULTY_METRICS",
    "VALID_DISTILLATION_LOSSES",
    "VALID_DISTILLATION_METHODS",
    "VALID_DPO_VARIANTS",
    "VALID_EXPERT_ACTIVATIONS",
    "VALID_LOAD_BALANCING_LOSSES",
    "VALID_LOSS_TYPES",
    "VALID_PACING_FUNCTIONS",
    "VALID_PPO_VARIANTS",
    "VALID_PRIVACY_MECHANISMS",
    "VALID_PRIVACY_MECHANISMS",
    "VALID_REFERENCE_POLICIES",
    "VALID_REGULARIZATION_TYPES",
    "VALID_REPLAY_STRATEGIES",
    "VALID_REWARD_MODEL_TYPES",
    "VALID_ROUTER_TYPES",
    "VALID_SAMPLING_STRATEGIES",
    "VALID_SHARDING_STRATEGIES",
    "VALID_STUDENT_INITIALIZATIONS",
    "VALID_TEMPERATURE_SCHEDULES",
    "VALID_VALUE_HEAD_TYPES",
    "ActivationCheckpointing",
    "AggregationMethod",
    "CallbackMetrics",
    "CheckpointConfig",
    "ClientConfig",
    "ClientSelectionStrategy",
    "ComputeType",
    "ContinualConfig",
    "ContinualMethod",
    "CurriculumConfig",
    "CurriculumStats",
    "DPOConfig",
    "DPOStats",
    "DPOTrainingConfig",
    "DPOVariant",
    "DeepSpeedConfig",
    "DeepSpeedStage",
    "DifficultyConfig",
    "DifficultyMetric",
    "DistillationConfig",
    "DistillationLoss",
    "DistillationLossConfig",
    "DistillationMethod",
    "DistillationStats",
    "DistributedBackend",
    "DistributedConfig",
    "EWCConfig",
    "EarlyStoppingConfig",
    "ExpertActivation",
    "ExpertConfig",
    "FSDPConfig",
    "FeatureMatchingConfig",
    "FederatedConfig",
    "FederatedStats",
    "ForgettingMetrics",
    "LoRAConfig",
    "LoadBalanceConfig",
    "LoadBalancingLoss",
    "LoggingConfig",
    "LossType",
    "MemoryEstimate",
    "MetricMode",
    "MoEConfig",
    "MoEStats",
    "PPOConfig",
    "PPOStats",
    "PPOTrainingConfig",
    "PPOVariant",
    "PacingConfig",
    "PacingFunction",
    "PreferencePair",
    "PrivacyConfig",
    "PrivacyMechanism",
    "QLoRAConfig",
    "QLoRATrainingConfig",
    "QuantConfig",
    "QuantType",
    "ReferenceConfig",
    "ReferencePolicy",
    "RegularizationType",
    "ReplayConfig",
    "ReplayStrategy",
    "RewardConfig",
    "RewardModelType",
    "RouterConfig",
    "RouterType",
    "SamplingStrategy",
    "ScalingMetrics",
    "SchedulerConfig",
    "SchedulerType",
    "ShardingStrategy",
    "StudentConfig",
    "StudentInitialization",
    "TaskType",
    "TeacherConfig",
    "TemperatureSchedule",
    "TrainerState",
    "TrainingConfig",
    "TrainingProgress",
    "ValueConfig",
    "ValueHeadType",
    "aggregate_updates",
    "calculate_backward_transfer",
    "calculate_capacity_factor",
    "calculate_client_weights",
    "calculate_combined_loss",
    "calculate_competence_score",
    "calculate_dpo_loss",
    "calculate_ewc_penalty",
    "calculate_fisher_information",
    "calculate_forgetting_measure",
    "calculate_forward_transfer",
    "calculate_gae",
    "calculate_load_balance_loss",
    "calculate_lora_memory_savings",
    "calculate_plasticity_score",
    "calculate_ppo_loss",
    "calculate_privacy_budget",
    "calculate_qlora_trainable_params",
    "calculate_router_entropy",
    "calculate_sample_difficulty",
    "calculate_sample_weights",
    "calculate_scaling_efficiency",
    "calculate_soft_labels_loss",
    "calculate_temperature_at_step",
    "compute_num_training_steps",
    "compute_warmup_steps",
    "create_client_config",
    "create_continual_config",
    "create_curriculum_config",
    "create_curriculum_stats",
    "create_deepspeed_config",
    "create_difficulty_config",
    "create_distillation_config",
    "create_distillation_stats",
    "create_distributed_config",
    "create_dpo_config",
    "create_dpo_training_config",
    "create_early_stopping_callback",
    "create_ewc_config",
    "create_expert_config",
    "create_feature_matching_config",
    "create_federated_config",
    "create_federated_stats",
    "create_forgetting_metrics",
    "create_fsdp_config",
    "create_load_balance_config",
    "create_logging_callback",
    "create_lora_config",
    "create_loss_config",
    "create_moe_config",
    "create_moe_stats",
    "create_pacing_config",
    "create_ppo_config",
    "create_ppo_training_config",
    "create_preference_pair",
    "create_privacy_config",
    "create_qlora_config",
    "create_qlora_training_config",
    "create_quant_config",
    "create_reference_config",
    "create_replay_config",
    "create_reward_config",
    "create_router_config",
    "create_student_config",
    "create_teacher_config",
    "create_trainer",
    "create_trainer_state",
    "create_training_args",
    "create_training_progress",
    "create_value_config",
    "estimate_compression_ratio",
    "estimate_convergence_rounds",
    "estimate_deepspeed_memory",
    "estimate_expert_utilization",
    "estimate_fsdp_memory",
    "estimate_importance_weights",
    "estimate_lora_parameters",
    "estimate_model_parameters",
    "estimate_qlora_memory",
    "estimate_training_steps",
    "format_curriculum_stats",
    "format_distillation_stats",
    "format_federated_stats",
    "format_forgetting_metrics",
    "format_memory_estimate",
    "format_moe_stats",
    "format_qlora_memory_estimate",
    "format_training_progress",
    "get_aggregation_method",
    "get_bnb_config",
    "get_checkpoint_path",
    "get_checkpoints_to_delete",
    "get_client_selection_strategy",
    "get_compute_type",
    "get_continual_method",
    "get_deepspeed_stage",
    "get_difficulty_at_step",
    "get_difficulty_metric",
    "get_distillation_loss",
    "get_distillation_method",
    "get_dpo_variant",
    "get_early_stopping_mode",
    "get_expert_activation",
    "get_latest_checkpoint",
    "get_layer_mapping_strategy",
    "get_load_balancing_loss",
    "get_loss_type",
    "get_pacing_function",
    "get_peft_config",
    "get_ppo_variant",
    "get_privacy_mechanism",
    "get_qlora_peft_config",
    "get_quant_type",
    "get_recommended_callbacks",
    "get_recommended_continual_config",
    "get_recommended_curriculum_config",
    "get_recommended_distillation_config",
    "get_recommended_federated_config",
    "get_recommended_lora_config",
    "get_recommended_moe_config",
    "get_recommended_qlora_config",
    "get_recommended_strategy",
    "get_reference_policy",
    "get_regularization_type",
    "get_replay_strategy",
    "get_reward_model_type",
    "get_router_type",
    "get_sampling_strategy",
    "get_scheduler_type",
    "get_sharding_strategy",
    "get_student_initialization",
    "get_temperature_schedule",
    "get_value_head_type",
    "is_metric_improved",
    "list_aggregation_methods",
    "list_backends",
    "list_callback_types",
    "list_checkpoints",
    "list_client_selection_strategies",
    "list_compute_types",
    "list_continual_methods",
    "list_deepspeed_stages",
    "list_difficulty_metrics",
    "list_distillation_losses",
    "list_distillation_methods",
    "list_dpo_variants",
    "list_early_stopping_modes",
    "list_expert_activations",
    "list_load_balancing_losses",
    "list_loss_types",
    "list_pacing_functions",
    "list_ppo_variants",
    "list_privacy_mechanisms",
    "list_quant_bits",
    "list_quant_types",
    "list_reference_policies",
    "list_regularization_types",
    "list_replay_strategies",
    "list_reward_model_types",
    "list_router_types",
    "list_sampling_strategies",
    "list_scheduler_types",
    "list_sharding_strategies",
    "list_student_initializations",
    "list_task_types",
    "list_temperature_schedules",
    "list_value_head_types",
    "select_clients",
    "should_stop_early",
    "update_trainer_state",
    "validate_checkpoint_config",
    "validate_client_config",
    "validate_compute_type",
    "validate_continual_config",
    "validate_curriculum_config",
    "validate_curriculum_stats",
    "validate_deepspeed_config",
    "validate_difficulty_config",
    "validate_distillation_config",
    "validate_distributed_config",
    "validate_dpo_config",
    "validate_early_stopping_config",
    "validate_ewc_config",
    "validate_expert_config",
    "validate_feature_matching_config",
    "validate_federated_config",
    "validate_federated_stats",
    "validate_forgetting_metrics",
    "validate_fsdp_config",
    "validate_load_balance_config",
    "validate_logging_config",
    "validate_loss_config",
    "validate_moe_config",
    "validate_pacing_config",
    "validate_ppo_config",
    "validate_ppo_training_config",
    "validate_preference_pair",
    "validate_privacy_config",
    "validate_qlora_config",
    "validate_quant_config",
    "validate_quant_type",
    "validate_replay_config",
    "validate_reward_config",
    "validate_router_config",
    "validate_scheduler_config",
    "validate_scheduler_type",
    "validate_student_config",
    "validate_teacher_config",
    "validate_trainer_state",
    "validate_training_config",
    "validate_value_config",
]
